<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TIKTOK DOWNLOADER</title>
    <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <link href="prism.css" rel="stylesheet" />
</head>
<body>
<section class="section">
    <nav class="navbar is-fixed-top is-info">
  <div class="navbar-brand">
    <a class="navbar-item" href="https://bulma.io">
      <img src="https://bulma.io/images/bulma-logo.png" alt="Bulma: a modern CSS framework based on Flexbox" width="112" height="28">
    </a>
    <div class="navbar-burger" data-target="navbarExampleTransparentExample">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>

  <div id="navbarExampleTransparentExample" class="navbar-menu">
    <div class="navbar-start">
      <a class="navbar-item" href="https://bulma.io/">
        Home
      </a>
      <div class="navbar-item has-dropdown is-hoverable">
        <a class="navbar-link" href="https://bulma.io/documentation/overview/start/">
          Docs
        </a>
      </div>
    </div>

    
  </div>

  <div class="navbar-end">
      <div class="navbar-item">
        <div class="pr-3">
            <div class="control is-fullwidth">
                <input class="input is-fullwidth" type="search" placeholder="URL URLBIRD" name="url">
            </div>
        </div>
        <div class="field is-grouped mt-1 is-justify-content-flex-end pr-3">
            <div class="control">
                <span class="button is-info is-light is-fullwidth" id="tempel">Tempel</span>
            </div>
            <div class="control">
                <span class="button is-danger is-light is-fullwidth" id="tambah">Tambah</span>
            </div>
        </div>
      </div>
    </div>
</nav>

    <div class="container mt-4">
        <h1 class="title">TIKTOK DOWNLOADER</h1>
        <p class="subtitle">KOMPILATOR VIDEO TIKTOK</p>
        <hr>

        <div class="field">
            <label class="label">LIST FOTO (<span id="jumlah">0</span>)</label>
            <div class="columns is-multiline is-mobile" id="listurl">
            
            </div>
        </div>



        <div class="field">
          <label class="label">SCRIPT GOOGLE COLAB</label>
          <div class="control" data-prismjs-copy-timeout="500">
            <pre><code class="language-python" data-prismjs-copy="Copy Script" id="json"></code></pre>
          </div>
        </div>


        <div class="field">
          <label class="label">SCRIPT FFMPEG</label>
          <div class="control" data-prismjs-copy-timeout="500">
            <pre><code class="language-bash" data-prismjs-copy="Copy Script" id="ffmpeg"></code></pre>
          </div>
        </div>
    

        <div class="field is-grouped">
          <div class="control">
            <button class="button is-success" id="copy">Copy Script</button>
          </div>
          <div class="control">
            <button class="button is-danger" onclick="location.reload()">Clear</button>
          </div>
        </div>

    </div>


  </section>
</body>
<script src="prism.js"></script>
<script type="text/javascript">
    
    (function () {
        var burger = document.querySelector('.navbar-burger');
        var menu = document.querySelector('#' + burger.dataset.target);
        burger.addEventListener('click', function () {
            burger.classList.toggle('is-active');
            menu.classList.toggle('is-active');
        });


    })();

    document.addEventListener('DOMContentLoaded',function(){
        let pasteButton = document.getElementById('tempel');
        pasteButton.addEventListener('click', function () {
            navigator.clipboard
                .readText()
                .then(
                    cliptext =>
                        ($('input[name="url"]').val(cliptext)),
                        err => console.log(err)
                );
        });
    })

    function jsonurl(){
        var jumlah=0
        var video={'tiktokurl':[]}
        var dataList = $(".urltiktok").map(function() {
            jumlah+=1
            return $(this).data("url");
        }).get();
        $('#jumlah').html(jumlah)
        $('#ffmpeg').html("!ffmpeg -f concat -safe 0 -i mylist.txt -c copy output.mp4")
        video['tiktokurl']=dataList
        var script=`!pip install selenium
!apt-get update 
!apt install chromium-chromedriver

url=${JSON.stringify(video)}

from selenium import webdriver
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.common.by import By
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.common.action_chains import ActionChains
from selenium.common.exceptions import TimeoutException

for u in url['tiktokurl']:
    try:
        chrome_options = webdriver.ChromeOptions()
        chrome_options.add_argument('--headless')
        chrome_options.add_argument('--no-sandbox')
        chrome_options.add_argument('--disable-dev-shm-usage')
        wd = webdriver.Chrome('chromedriver',chrome_options=chrome_options)
        driver =webdriver.Chrome('chromedriver',chrome_options=chrome_options)
        wait = WebDriverWait(driver, 20)
        driver.get("https://snaptik.app/en")
        input_tag = driver.find_element(By.XPATH, "/html/body/main/div[1]/div/div[2]/form/div/div[3]/input")
        input_tag.send_keys(u)
        input_tag.submit()
        wait.until(EC.visibility_of_element_located((By.XPATH, '/html/body/main/div[2]/div/div/div[1]/div/div[1]'))).click()
        element=driver.find_element(By.LINK_TEXT,"Download").click()
        print(element)
    except TimeoutException as ex:
        print("#### LINK ERROR : "+u)
        driver.close()

import glob
f = open("mylist.txt", "w")
files = glob.iglob('*.mp4')
files_i_care_about = filter(lambda x: not x.startswith("output.mp4"), files)
f.write('\\n'.join(["file '"+s+"'" for s in files_i_care_about]))
f.close()

!ffmpeg -f concat -safe 0 -i mylist.txt -crf 21 -c copy output.mp4

##!mv /content/output.mp4 /content/drive/MyDrive/output.mp4
`
    $('#json').html(script)
    }
    function hapus(id){
        console.log(id)
        $(`#${id}`).remove()
        jsonurl()
    }

    function extractid(){
        var urltiktok=$('input[name="url"]').val()
        var rx = /[0-9]{19}/g;
        var arr = urltiktok.match(rx);
        return arr.pop()
    }

    $('#tambah').on('click',function(){
        var urltiktok=extractid()
        urltiktok='https://m.tiktok.com/v/'+urltiktok+'.html'
        $.ajax({
          type: "GET",
          url: `https://www.tiktok.com/oembed?url=${urltiktok}`,
          success: function(msg){
                console.log(msg,`https://www.tiktok.com/oembed?url=${urltiktok}`)
                $('#listurl').append(`
                    <div class="urltiktok column is-half-mobile is-one-quarter-desktop is-half-tablet" id="${msg.embed_product_id}" data-url="${msg.author_url+'/video/'+msg.embed_product_id}">
                        <div class="card">
                            <div class="card-image">
                                <figure class="image is-3by2">
                                  <img src="${msg.thumbnail_url}" alt="">
                                </figure>
                                <div class="card-content is-overlay is-clipped">
                                  <span class="tag is-danger">
                                    ${msg.embed_product_id}
                                  </span>       
                                </div>
                            </div>
                            <footer class="card-footer">
                                <a class="card-footer-item" onClick="hapus('${msg.embed_product_id}')">
                                  Hapus
                                </a>
                            </footer>
                        </div>
                    </div>
                `)
                jsonurl()
          },
          error: function(XMLHttpRequest, textStatus, errorThrown) {
             alert("URL SALAH");
          }
        });
    })


    $("#copy").click(function(){
        $("#code").select();
        document.execCommand('copy');
    });
    
</script>
</html>